---
title: "DDharmonize_validate_PopCounts"
output: rmarkdown::html_vignette
description: >
  This function implements a workflow for population data extracted from censuses, registers or estimation. This workflow includes extracting data from the UNPD database, harmonizing age groups, identifying full series, validating totals and by sex and eventually producing clean and harmonised datasets for each location. 
vignette: >
  %\VignetteIndexEntry{DDharmonize_validate_PopCounts}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r, echo=FALSE}
library(icons)
```

## `r icons::fontawesome("rocket", style = "solid")` Introduction

`DDharmonize_validate_PopCounts()` is a function that implements a work flow for population data extracted from censuses, registers or estimation. This work flow includes extracting data from the UNPD (United Nations Population Division) database, harmonizing age groups, identifying full series, validating totals and by sex and eventually producing clean and harmonised datasets for each location. 

## `r icons::fontawesome("cog", style = "solid")` Function definition

```{r}
library(rddharmony)
clean_df <- DDharmonize_validate_PopCounts(locid = 533,
                                             times = c(2010, 2011),
                                             process = c("census", "estimate", "register"),
                                             return_unique_ref_period = TRUE,
                                             retainKeys = FALSE)
```

## `r icons::fontawesome("wrench", style = "solid")` Description of the function arguments

The function contains several arguments:

**`locid`:** This is the a numeric variable representing the location id of each of the locations. You can run `View(get_locations())` to get the list of plausible location ids. The ids are listed in the `PK_LocID` variable. 
You can also run the function `check_locid(insert locid here)` to check whether a location id is valid (part of the locations in the UNPD website). Running `check_locid(insert locid here)` with a valid id returns a message confirming that the location id is valid and also gives the location name of that particular id. Running the same code with an invalid id returns a message directing the user to run `View(get_locations())` in order to get a list of plausible location ids. See example below.

```{r checking validity of location ids}
## valid id
check_locid(533)

## invalid id
check_locid(12345)
```


**`times`:** The period of the data to be extracted. You can extract one year data e.g `times = 2020` or a longer period of time e.g `times = c(1950, 2020)`.

**`process`:** The process through which the data was obtained from various sources i.e either via census or vital registrations (vr). By default, the function pulls data obtained through both of these processes.

**`return_unique_ref_period`:** Specifies whether the data to be returned should contain one unique id (`return_unique_ref_period == TRUE`) or several ids (`return_unique_ref_period == FALSE`) per time label. ids are a unique identifier for each unique set of records based on `LocID`, `LocName`, `DataProcess`, `ReferencePeriod`, `DataSourceName`, `StatisticalConceptName`, `DataTypeName` and `DataReliabilityName`. The definitions of these variables are provided later in this article.

**`retainKeys`:** Specifies whether only a few (`retainKeys == FALSE`) or all (`retainKeys == TRUE`) variables should be retained in the output.

## `r icons::fontawesome("table", style = "solid")` Description of the output variables

The function returns clean data with 25 variables (when `retainKeys == TRUE`) which are defined below:

+ id:

+ LocID:

+ LocName

+ IndicatorID: 

+ IndicatorName: 

+ TimeLabel: 

+ TimeMid

+ TimeEnd

+ DataProcessType

+ DataSourceName

+ StatisticalConceptName 

+ DataTypeName  

+ DataReliabilityName

+ five_year            

+ abridged      

+ complete      

+ non_standard   

+ SexID         

+ AgeStart       

+ AgeEnd 

+ AgeLabel   

+ AgeSpan 

+ AgeSort 

+ DataValue    

+ note                  

